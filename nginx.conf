# Server configuration for our React application
server {
 # Nginx will listen on port 80 (inside the container)
 listen 80;
 # Location to serve the React app (Single Page Application)
 location / {
  root /usr/share/nginx/html;
  index index.html index.htm;
  try_files $uri $uri/ /index.html;
 }

 # --- LOCATION FOR REVERSE PROXY ---
 # All requests starting with /api/ will be handled here.
 location /api/ {
  # Forward the request to 'host.docker.internal' on port 8000.
  proxy_pass http://host.docker.internal:8000/;
  # --- ADDED TIMEOUTS TO PREVENT 499/504 ERRORS ---
  # Increase the timeout values to give the backend more time to respond,
  # which helps prevent "Client Closed Request" or "Gateway Timeout" errors.
  proxy_connect_timeout 60s;
  proxy_send_timeout  60s;
  proxy_read_timeout  60s;
  send_timeout     60s;

  # Set useful headers for the backend.
  proxy_set_header Host $host;
  proxy_set_header X-Real-IP $remote_addr;
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_set_header X-Forwarded-Proto $scheme;
 }

}